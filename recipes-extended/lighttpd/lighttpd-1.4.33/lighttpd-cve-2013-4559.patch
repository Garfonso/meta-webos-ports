origin: http://download.lighttpd.net/lighttpd/security/lighttpd_sa_2013_02.txt

commit d22f4164a9e26c252e1874a29ba658eec85a3ddc
Author: Stefan BÃ¼hler <stbuehler@web.de>
Date:   Sun Nov 10 19:00:08 2013 +0100

    [core] check success of setuid,setgid,setgroups

Index: lighttpd-1.4.28/src/server.c
===================================================================
--- lighttpd-1.4.28.orig/src/server.c	2013-11-13 03:13:00.902516775 +0000
+++ lighttpd-1.4.28/src/server.c	2013-11-13 03:13:19.942516611 +0000
@@ -794,8 +794,14 @@
 		 * to /etc/group
 		 * */
 		if (NULL != grp) {
-			setgid(grp->gr_gid);
-			setgroups(0, NULL);
+			if (-1 == setgid(grp->gr_gid)) {
+				log_error_write(srv, __FILE__, __LINE__, "ss", "setgid failed: ", strerror(errno));
+				return -1;
+			}
+			if (-1 == setgroups(0, NULL)) {
+				log_error_write(srv, __FILE__, __LINE__, "ss", "setgroups failed: ", strerror(errno));
+				return -1;
+			}
 			if (srv->srvconf.username->used) {
 				initgroups(srv->srvconf.username->ptr, grp->gr_gid);
 			}
@@ -818,7 +824,10 @@
 #ifdef HAVE_PWD_H
 		/* drop root privs */
 		if (NULL != pwd) {
-			setuid(pwd->pw_uid);
+			if (-1 == setuid(pwd->pw_uid)) {
+				log_error_write(srv, __FILE__, __LINE__, "ss", "setuid failed: ", strerror(errno));
+				return -1;
+			}
 		}
 #endif
 #if defined(HAVE_SYS_PRCTL_H) && defined(PR_SET_DUMPABLE)
